//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a code generation tool.
//     Changes to this file may cause incorrect behavior and will be lost
//     if the code is regenerated.
//
//     Generator: IonPath Codegen
// </auto-generated>
//------------------------------------------------------------------------------

#pragma warning disable
#nullable enable


namespace ArgonContracts;

public sealed class Ion_ChannelInteraction_ServiceExecutor(AsyncServiceScope scope) : IServiceExecutorRouter
{
    
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task CreateChannel_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 3;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
        var __request = IonFormatterStorage<CreateChannelRequest>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        await service.CreateChannel(__spaceid, __channelid, __request);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task DeleteChannel_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 2;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        await service.DeleteChannel(__spaceid, __channelid);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task GetChannels_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 2;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        var result = await service.GetChannels(__spaceid, __channelid);
        
        IonFormatterStorage<RealtimeChannel>.WriteArray(writer, result);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task QueryMessages_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 4;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
        var __from = reader.ReadNullable<i8>();
        var __limit = IonFormatterStorage<i4>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        var result = await service.QueryMessages(__spaceid, __channelid, __from, __limit);
        
        IonFormatterStorage<ArgonMessage>.WriteArray(writer, result);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task SendMessage_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 6;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
        var __text = IonFormatterStorage<string>.Read(reader);
        var __entities = IonFormatterStorage<IMessageEntity>.ReadArray(reader);
        var __randomid = IonFormatterStorage<i8>.Read(reader);
        var __replyto = reader.ReadNullable<i8>();
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        var result = await service.SendMessage(__spaceid, __channelid, __text, __entities, __randomid, __replyto);
        
        IonFormatterStorage<i8>.Write(writer, result);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task DisconnectFromVoiceChannel_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 2;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        await service.DisconnectFromVoiceChannel(__spaceid, __channelid);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task Interlink_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 2;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        var result = await service.Interlink(__spaceid, __channelid);
        
        IonFormatterStorage<IInterlinkResult>.Write(writer, result);
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task KickMemberFromChannel_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IChannelInteraction>();
    
        const int argumentSize = 3;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __spaceid = IonFormatterStorage<guid>.Read(reader);
        var __channelid = IonFormatterStorage<guid>.Read(reader);
        var __memberid = IonFormatterStorage<guid>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        var result = await service.KickMemberFromChannel(__spaceid, __channelid, __memberid);
        
        IonFormatterStorage<bool>.Write(writer, result);
    }

    
    
    
        public Task RouteExecuteAsync(string methodName, CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        
        if (methodName.Equals("CreateChannel", StringComparison.InvariantCultureIgnoreCase))
            return CreateChannel_Execute(reader, writer, ct);
        if (methodName.Equals("DeleteChannel", StringComparison.InvariantCultureIgnoreCase))
            return DeleteChannel_Execute(reader, writer, ct);
        if (methodName.Equals("GetChannels", StringComparison.InvariantCultureIgnoreCase))
            return GetChannels_Execute(reader, writer, ct);
        if (methodName.Equals("QueryMessages", StringComparison.InvariantCultureIgnoreCase))
            return QueryMessages_Execute(reader, writer, ct);
        if (methodName.Equals("SendMessage", StringComparison.InvariantCultureIgnoreCase))
            return SendMessage_Execute(reader, writer, ct);
        if (methodName.Equals("DisconnectFromVoiceChannel", StringComparison.InvariantCultureIgnoreCase))
            return DisconnectFromVoiceChannel_Execute(reader, writer, ct);
        if (methodName.Equals("Interlink", StringComparison.InvariantCultureIgnoreCase))
            return Interlink_Execute(reader, writer, ct);
        if (methodName.Equals("KickMemberFromChannel", StringComparison.InvariantCultureIgnoreCase))
            return KickMemberFromChannel_Execute(reader, writer, ct);

        
        throw new InvalidOperationException("no method defined");
    }
    
    private static readonly string[] __allowedStreamingMethods = [
        
    ];
    
    public bool IsAllowInputStream(string methodName) => __allowedStreamingMethods.Contains(methodName);
}

public sealed class Ion_EventBus_ServiceExecutor(AsyncServiceScope scope) : IServiceExecutorRouter, IServiceStreamExecutorRouter
{
    
    public async IAsyncEnumerable<Memory<byte>> ForServer_Execute(CborReader reader, IAsyncEnumerable<ReadOnlyMemory<byte>>? inputStream, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IEventBus>();

        const int argumentSize = 1;
        
        

        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
            
        var __spaceid = IonFormatterStorage<guid>.Read(reader);

        reader.ReadEndArrayAndSkip(arraySize - argumentSize);

        await foreach (var e in service.ForServer(__spaceid, ct))
        {
            var writer = new CborWriter();

            IonFormatterStorage<IArgonEvent>.Write(writer, e);

            var mem = MemoryPool<byte>.Shared.Rent(writer.BytesWritten);

            writer.Encode(mem.Memory.Span);

            yield return mem.Memory;

            mem.Dispose();
        }
    }
    [GeneratedCodeAttribute("ionc", null), CompilerGeneratedAttribute]
    public async Task Dispatch_Execute(CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IEventBus>();
    
        const int argumentSize = 1;
    
        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
    
        var __ev = IonFormatterStorage<IArgonClientEvent>.Read(reader);
    
        reader.ReadEndArrayAndSkip(arraySize - argumentSize);
    
        await service.Dispatch(__ev);
    }
    public async IAsyncEnumerable<Memory<byte>> Pipe_Execute(CborReader reader, IAsyncEnumerable<ReadOnlyMemory<byte>>? inputStream, CancellationToken ct = default)
    {
        var service = scope.ServiceProvider.GetRequiredService<IEventBus>();

        const int argumentSize = 0;
        
        var inputStreamCasted = inputStream is null
? null
: inputStream.Select(bytes =>
{
    var reader = new CborReader(bytes);
    var arr = reader.ReadStartArray();
    var result = IonFormatterStorage<IArgonClientEvent>.Read(reader);
    reader.ReadEndArray();

    return result;
});

        var arraySize = reader.ReadStartArray() ?? throw new Exception("undefined len array not allowed");
            
        

        reader.ReadEndArrayAndSkip(arraySize - argumentSize);

        await foreach (var e in service.Pipe(inputStreamCasted, ct))
        {
            var writer = new CborWriter();

            IonFormatterStorage<IArgonEvent>.Write(writer, e);

            var mem = MemoryPool<byte>.Shared.Rent(writer.BytesWritten);

            writer.Encode(mem.Memory.Span);

            yield return mem.Memory;

            mem.Dispose();
        }
    }

    
    
    public IAsyncEnumerable<Memory<byte>> StreamRouteExecuteAsync(string methodName, CborReader reader, IAsyncEnumerable<ReadOnlyMemory<byte>>? inputStream, [EnumeratorCancellation] CancellationToken ct)
    {
        
        if (methodName.Equals("ForServer", StringComparison.InvariantCultureIgnoreCase))
            return ForServer_Execute(reader, inputStream, ct);
        if (methodName.Equals("Pipe", StringComparison.InvariantCultureIgnoreCase))
            return Pipe_Execute(reader, inputStream, ct);

        
        throw new InvalidOperationException("no method defined");
    }
    
        public Task RouteExecuteAsync(string methodName, CborReader reader, CborWriter writer, CancellationToken ct = default)
    {
        
        if (methodName.Equals("Dispatch", StringComparison.InvariantCultureIgnoreCase))
            return Dispatch_Execute(reader, writer, ct);

        
        throw new InvalidOperationException("no method defined");
    }
    
    private static readonly string[] __allowedStreamingMethods = [
        "Pipe"
    ];
    
    public bool IsAllowInputStream(string methodName) => __allowedStreamingMethods.Contains(methodName);
}

